<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head', { 
        cssFiles: ['account.css'], 
        scripts: [] 
  }) %>

  <body>
    <%- include('../partials/navbar') %>

    <main id="main-content">
      <section class="section" aria-labelledby="account-title">
        <div class="container account">
          <header class="section__header">
            <h1 id="account-title">Your account</h1>
            <a class="link" href="/shop"><%- include('../icon', { name: 'back' }) %> Continue shopping</a>
          </header>

          <!-- Top summary row -->
          <div class="account-summary">
            <div class="card card--profile" role="region" aria-labelledby="profile-h">
              <div class="card__hd">
                <h2 id="profile-h" class="card__title">Profile</h2>
                <a class="link link--sm" href="/account/profile">Manage</a>
              </div>
              <div class="card__body">
                <div class="avatar">
                  <% const initials = (user?.first_name?.[0] || '') + (user?.last_name?.[0] || ''); %>
                  <span aria-hidden="true"><%= initials || 'U' %></span>
                </div>
                <div class="profile-meta">
                  <p class="profile-name"><%= user?.first_name %> <%= user?.last_name %></p>
                  <p class="profile-email"><%= user?.email %></p>
                  <% if (user?.phone) { %><p class="profile-phone"><%= user.phone %></p><% } %>
                </div>
              </div>
              <div class="card__ft">
                <a href="/account/security" class="button ghost small">Password & security</a>
              </div>
            </div>

            <div class="card card--orders" role="region" aria-labelledby="orders-h">
              <div class="card__hd">
                <h2 id="orders-h" class="card__title">Orders</h2>
                <a class="link link--sm" href="/account/orders">View all</a>
              </div>
              <div class="card__body">
                <ul class="mini-stats" aria-label="Order quick stats">
                  <li>
                    <span class="mini-stats__value"><%= stats?.orders_total ?? 0 %></span>
                    <span class="mini-stats__label">Total</span>
                  </li>
                  <li>
                    <span class="mini-stats__value"><%= stats?.orders_open ?? 0 %></span>
                    <span class="mini-stats__label">Open</span>
                  </li>
                  <li>
                    <span class="mini-stats__value"><%= stats?.returns ?? 0 %></span>
                    <span class="mini-stats__label">Returns</span>
                  </li>
                </ul>
              </div>
              <div class="card__ft">
                <a href="/account/orders/new" class="button primary small">Start a return</a>
              </div>
            </div>

            <div class="card card--addresses" role="region" aria-labelledby="addr-h">
              <div class="card__hd">
                <h2 id="addr-h" class="card__title">Addresses</h2>
                <a class="link link--sm" href="/account/addresses">Manage</a>
              </div>
              <div class="card__body">
                <% if (addresses && addresses.length) { %>
                  <div class="address">
                    <% const addr = addresses?.find(a => a.is_default_shipping) || addresses?.[0]; %>
                    <% if (addr) { %>
                      <p><%= addr.full_name %> <% if (addr.label) { %><span class="badge"><%= addr.label %></span><% } %></p>
                      <p><%= addr.line1 %><% if (addr.line2) { %>, <%= addr.line2 %><% } %></p>
                      <p><%= addr.city %>, <%= addr.region || '' %> <%= addr.postal_code %></p>
                      <p><%= addr.country_code %></p>
                      <% if (addr.is_default_shipping) { %><span class="badge">Default shipping</span><% } %>
                      <% if (addr.is_default_billing) { %><span class="badge">Default billing</span><% } %>
                    <% } else { %>
                      <p class="muted">No saved addresses yet.</p>
                    <% } %>
                  </div>
                <% } else { %>
                  <p class="muted">No saved addresses yet.</p>
                <% } %>
              </div>
              <div class="card__ft">
                <a href="/account/addresses/new" class="button ghost small">Add address</a>
              </div>
            </div>
          </div>

          <!-- Recent orders table -->
          <section class="recent" aria-labelledby="recent-h">
            <div class="section__header">
              <h2 id="recent-h">Recent orders</h2>
              <a class="link" href="/account/orders">View all</a>
            </div>

            <% if (recentOrders && recentOrders.length) { %>
              <div class="table-wrap" role="region" aria-label="Recent orders">
                <table class="table">
                  <thead>
                    <tr>
                      <th scope="col">Order</th>
                      <th scope="col">Date</th>
                      <th scope="col">Total</th>
                      <th scope="col">Status</th>
                      <th scope="col"><span class="sr-only">Actions</span></th>
                    </tr>
                  </thead>
                  <tbody>
                    <% recentOrders.forEach(o => { %>
                      <tr>
                        <td><a class="link" href="/account/orders/<%= o.id %>">#<%= o.number %></a></td>
                        <td><time datetime="<%= o.placed_at %>"><%= o.placed_at_display %></time></td>
                        <td><%= o.total_display %></td>
                        <td>
                          <span class="status status--<%= (o.status || 'unknown').toLowerCase() %>"><%= o.status_display %></span>
                        </td>
                        <td><a class="link link--sm" href="/account/orders/<%= o.id %>">View</a></td>
                      </tr>
                    <% }) %>
                  </tbody>
                </table>
              </div>
            <% } else { %>
              <div class="empty">
                <p class="prose">No orders yet. When you place an order, you‚Äôll see it here with tracking and status.</p>
                <a class="button primary" href="/shop">Shop now</a>
              </div>
            <% } %>
          </section>

          <!-- Quick actions / support -->
          <section class="quick" aria-labelledby="quick-h">
            <div class="section__header">
              <h2 id="quick-h">Quick actions</h2>
              <span class="spacer"></span>
            </div>

            <div class="quick-grid">
              <a class="quick-item" href="/account/profile">
                <div class="quick-item__icon" aria-hidden="true">üë§</div>
                <div class="quick-item__text">
                  <h3>Update profile</h3>
                  <p>Change name, email, or phone.</p>
                </div>
              </a>

              <a class="quick-item" href="/account/security">
                <div class="quick-item__icon" aria-hidden="true">üîí</div>
                <div class="quick-item__text">
                  <h3>Security</h3>
                  <p>Change password or 2FA.</p>
                </div>
              </a>

              <a class="quick-item" href="/account/addresses">
                <div class="quick-item__icon" aria-hidden="true">üè†</div>
                <div class="quick-item__text">
                  <h3>Addresses</h3>
                  <p>Add or edit saved addresses.</p>
                </div>
              </a>

              <a class="quick-item" href="/account/orders">
                <div class="quick-item__icon" aria-hidden="true">üì¶</div>
                <div class="quick-item__text">
                  <h3>Track orders</h3>
                  <p>View status & tracking info.</p>
                </div>
              </a>
            </div>
          </section>
        </div>
      </section>
    </main>

    <%- include('../partials/footer') %>
  </body>
</html>
