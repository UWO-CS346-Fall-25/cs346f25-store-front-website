<!DOCTYPE html>
<html lang="en">
<%- include('../partials/head', { title: 'Admin · Message Senders', cssFiles: ['admin/dashboard.css', 'admin.css', 'admin/logs.css'], scripts: [] }) %>
<body>
  <%- include('../partials/navbar') %>

  <main id="main-content">
    <header class="admin-header">
      <h1>Message Senders</h1>
      <p class="subtitle">Users who have sent messages and their latest message.</p>
    </header>
    <section class="section" aria-labelledby="admin-message-senders-heading">
      <div class="container">

        <%- include('../partials/flash') %>

        <section class="admin-panel">
          <a href="/admin" class="link--button link" id="back-to-dashboard">
            <%- include('../icon', { name: 'back' }) %> Back to Dashboard
          </a>
          
          <% const rows = senders || []; %>
          <% if (!rows.length) { %>
            <p class="muted">No message senders found.</p>
          <% } else { %>
            <div class="admin-table-wrapper">
              <table class="admin-table admin-table--simple">
                <thead>
                  <tr>
                    <th>Sender</th>
                    <th style="width:140px;text-align:right">Last message at</th>
                  </tr>
                </thead>
                <tbody>
                  <% rows.forEach(function(r) { %>
                    <tr>
                        <td>
                          <a class="link" href="/admin/messages/thread?user=<%= encodeURIComponent(r.user_id || '') %>" style="display:block;color:inherit;text-decoration:none;">
                            <div style="display:flex;gap:8px;align-items:flex-start;">
                              <% if (r.unread) { %>
                                <span title="Unread" aria-hidden="true" style="width:12px;height:12px;border-radius:999px;background:var(--tint-2);display:inline-block;margin-top:6px;margin-right:6px;"></span>
                              <% } else { %>
                                <span style="width:12px;height:12px;display:inline-block;margin-right:6px;margin-top:6px;"></span>
                              <% } %>
                              <div style="display:flex;flex-direction:column;gap:6px;">
                                <div style="font-weight:600;"><%= r.name || r.user_id %></div>
                                <div class="muted" style="white-space:pre-wrap;"> <%= r.body ? r.body : '—' %></div>
                              </div>
                            </div>
                          </a>
                        </td>
                        <td class="muted" style="text-align:right;vertical-align:middle;"><%= r.created_at ? new Date(r.created_at).toLocaleString() : '—' %></td>
                      </tr>
                  <% }); %>
                </tbody>
              </table>
            </div>
          <% } %>

        </section>
      </div>
    </section>
  </main>

  <%- include('../partials/footer') %>
</body>
</html>