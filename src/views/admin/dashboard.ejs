<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head', { cssFiles: ['/admin/dashboard.css'], scripts: ['/admin-utilities'] }) %>
  <body>
    <%- include('../partials/navbar') %>
  <header class="admin-header">
    <h1>Admin Dashboard</h1>
    <p class="subtitle">Select a utility to manage or inspect system internals.</p>
  </header>
  <main class="admin-utilities">
    <% if (typeof groupedUtilities !== 'undefined' && groupedUtilities && groupedUtilities.length) { %>
      <% groupedUtilities.forEach(group => { %>
        <section class="utilities-group">
          <h3 class="utilities-group__title"><%= group.category %></h3>
          <div class="utilities-grid">
            <% group.items.forEach(util => { %>
              <a class="utility-card" href="<%= util.path %>" >
                <% 
                  let badgeLabel = null;
                  if (util.id === 'logs') {
                    if (util.errorCount && util.errorCount > 0) {
                      badgeLabel = (util.errorCount === 1) ? '1 error' : (String(util.errorCount) + ' errors');
                    }
                  } else if (util.count && util.count > 0) {
                    if (util.id === 'orders') badgeLabel = String(util.count) + ' pending orders';
                    else if (util.id === 'todo') badgeLabel = String(util.count) + ' open TODOs';
                    else badgeLabel = String(util.count) + ' draft items';
                  }
                %>
                <% if (util.id === 'logs') { %>
                  <% if (util.errorCount && util.errorCount > 0) { %>
                      <span class="utility-badge utility-badge--error" data-tooltip="<%= badgeLabel %>" aria-label="<%= badgeLabel %>" aria-hidden="false">
                        <span class="utility-badge__value" aria-hidden="true"><%= util.errorCount === 1 ? '!' : util.errorCount %></span>
                      </span>
                  <% } %>
                <% } else { %>
                  <% if (util.count && util.count > 0) { %>
                    <span class="utility-badge" data-tooltip="<%= badgeLabel %>" aria-label="<%= badgeLabel %>" aria-hidden="false">
                      <span class="utility-badge__value" aria-hidden="true"><%= util.count %></span>
                    </span>
                  <% } %>
                <% } %>
                <div class="utility-icon"><%- include('../icon', { name: util.icon }) %></div>
                <h2 class="utility-title"><%= util.name %></h2>
                <p class="utility-description"><%= util.description %></p>
              </a>
            <% }) %>
          </div>
        </section>
      <% }) %>
    <% } else { %>
      <section class="utilities-grid">
        <% utilities.forEach(util => { %>
        <a class="utility-card" href="<%= util.path %>" >
          <% 
            // compute a human-friendly label for tooltip/aria
            let badgeLabel = null;
            if (util.id === 'logs') {
              if (util.errorCount && util.errorCount > 0) {
                badgeLabel = (util.errorCount === 1) ? '1 error' : (String(util.errorCount) + ' errors');
              }
            } else if (util.count && util.count > 0) {
              if (util.id === 'orders') badgeLabel = String(util.count) + ' pending orders';
              else if (util.id === 'todo') badgeLabel = String(util.count) + ' open TODOs';
              else badgeLabel = String(util.count) + ' draft items';
            }
          %>
          <% if (util.id === 'logs') { %>
            <% if (util.errorCount && util.errorCount > 0) { %>
                <span class="utility-badge utility-badge--error" data-tooltip="<%= badgeLabel %>" aria-label="<%= badgeLabel %>" aria-hidden="false">
                  <% /* Visible content: '!' when single error, otherwise number. */ %>
                  <span class="utility-badge__value" aria-hidden="true"><%= util.errorCount === 1 ? '!' : util.errorCount %></span>
                </span>
            <% } %>
          <% } else { %>
            <% if (util.count && util.count > 0) { %>
              <span class="utility-badge" data-tooltip="<%= badgeLabel %>" aria-label="<%= badgeLabel %>" aria-hidden="false">
                <span class="utility-badge__value" aria-hidden="true"><%= util.count %></span>
              </span>
            <% } %>
          <% } %>
          <div class="utility-icon"><%- include('../icon', { name: util.icon }) %></div>
          <h2 class="utility-title"><%= util.name %></h2>
          <p class="utility-description"><%= util.description %></p>
        </a>
      <% }) %>
      </section>
    <% } %>
  </main>
</body>
</html>